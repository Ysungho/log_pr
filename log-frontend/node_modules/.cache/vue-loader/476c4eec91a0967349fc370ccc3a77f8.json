{"remainingRequest":"C:\\Visual Studio Code\\log-frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Visual Studio Code\\log-frontend\\src\\components\\Chart.vue?vue&type=template&id=4d06a4de","dependencies":[{"path":"C:\\Visual Studio Code\\log-frontend\\src\\components\\Chart.vue","mtime":1635836126000},{"path":"C:\\Visual Studio Code\\log-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1689391186843},{"path":"C:\\Visual Studio Code\\log-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1689391188787},{"path":"C:\\Visual Studio Code\\log-frontend\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1689391190261},{"path":"C:\\Visual Studio Code\\log-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1689391186843},{"path":"C:\\Visual Studio Code\\log-frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1689391189205}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdiA6Y2xhc3M9ImBDaGFydCBDaGFydC0ke2NoYXJ0VHlwZX1gIj4KICAgIDxkaXYgY2xhc3M9InRvb2x0aXAiPjwvZGl2PgogIDwvZGl2Pgo="},{"version":3,"sources":["C:\\Visual Studio Code\\log-frontend\\src\\components\\Chart.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACtC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC5B,CAAC,CAAC,CAAC,CAAC,CAAC","file":"C:/Visual Studio Code/log-frontend/src/components/Chart.vue","sourceRoot":"","sourcesContent":["<template>\n  <div :class=\"`Chart Chart-${chartType}`\">\n    <div class=\"tooltip\"></div>\n  </div>\n</template>\n<script>\n  import store from '../store'\n  import {\n    computed,\n    onMounted\n  } from 'vue'\n  import {\n    margin,\n    chartWidth,\n    chartHeight\n  } from '../config'\n  import * as d3 from 'd3'\n  const timeFormat = d3.timeFormat(\"%H:%M:%S\")\n  export default {\n    name: 'Chart',\n    props: {\n      type: String,\n      name: String,\n      unit: String\n    },\n    setup(props) {\n      let svg, xScale, yScale, xAxis, yAxis, tooltip, circle, area\n\n      const resTimeList = computed(() => store.getters['resTimeList'])\n      const chartType = computed(() => props.type)\n      const name = computed(() => props.name)\n      const unit = computed(() => props.unit)\n      const setAreaAndScale = (key) => {\n        svg = d3.select(`.Chart-${key}`).append(\"svg\")\n          .attr(\"width\", chartWidth + margin.left + margin.right)\n          .attr(\"height\", chartHeight + margin.top + margin.bottom)\n          .attr(\"class\", \"chartWrap\")\n          .append(\"g\")\n          .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n        xScale = d3.scaleTime().range([0, chartWidth])\n        yScale = d3.scaleLinear().range([chartHeight, 0])\n\n        xAxis = d3.axisBottom(xScale).tickFormat(timeFormat)\n        yAxis = d3.axisLeft(yScale)\n\n        area = d3.area()\n          .curve(d3.curveMonotoneX)\n          .x(d => xScale(d.time))\n          .y0(chartHeight)\n          .y1(d => yScale(d[key]))\n        tooltip = d3.select(`.tooltip`)\n      }\n      const initDraw = (data, key) => {\n        //data는 string형태로 오기 때문에 여기서 new Date 객체로 바꿔주어야 합니다.   \n        data.forEach(d => d.time = new Date(d.time));\n        const mn = d3.min(data, d => d[key])\n        const mx = d3.max(data, d => d[key])\n\n        //scale을 정합니다. yScale은 보기 좋게 margin 값을 적용합니다.\n        xScale.domain(d3.extent(data, d => d.time))\n        yScale.domain([mn - margin.value, mx + margin.value])\n\n        //x축과 y축을 설정합니다.  \n        svg.append(\"g\")\n          .attr(\"class\", \"x axis\")\n          .attr(\"transform\", `translate(0,${chartHeight})`)\n          .call(xAxis);\n        svg.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(yAxis);\n\n        // 그라데이션을 설정하기 위해 area\n        svg.append(\"linearGradient\")\n          .attr(\"id\", \"response-gradient\")\n          .attr(\"gradientUnits\", \"userSpaceOnUse\")\n          .attr(\"x1\", 0).attr(\"y1\", yScale(0))\n          .attr(\"x2\", 0).attr(\"y2\", yScale(mx))\n          .selectAll(\"stop\")\n          .data([{\n              offset: \"0%\",\n              color: \"#eef9f4\"\n            },\n            {\n              offset: \"100%\",\n              color: \"#4fc08d\"\n            }\n          ])\n          .enter().append(\"stop\")\n          .attr(\"offset\", function (d) {\n            return d.offset;\n          })\n          .attr(\"stop-color\", function (d) {\n            return d.color;\n          });\n        svg.append(\"path\")\n          .datum(data)\n          .attr(\"class\", \"area\")\n          .attr(\"d\", area);\n        circle = svg.selectAll(\"dot\")\n          .data(data)\n          .enter().append(\"circle\")\n          .attr(\"r\", 3)\n          .on(\"mouseover\", (event, d) => {\n            const content = `<p>${name.value}</p> <p>[${timeFormat(d.time)}]</p><h2>${d[key]}${unit.value}</h2>`\n            tooltip\n              .html(content)\n              .style(\"left\", (event.pageX - 80) + \"px\")\n              .style(\"top\", (event.pageY - 452) + \"px\")\n            tooltip.transition()\n              .duration(200)\n              .style(\"opacity\", 1)\n          })\n          .on(\"mouseout\", () => {\n            tooltip.transition()\n              .duration(200)\n              .style(\"opacity\", 0);\n          });\n        circle\n          .attr(\"cx\", d => xScale(d.time))\n          .attr(\"cy\", d => yScale(d[key]))\n\n\n      }\n      const draw = (data, key) => {\n        data.forEach(d => d.time = new Date(d.time));\n        const mn = d3.min(data, d => d[key])\n        const mx = d3.max(data, d => d[key])\n        xScale.domain(d3.extent(data, d => d.time))\n        yScale.domain([mn - margin.value, mx + margin.value])\n\n        svg.select(\".area\").transition().duration(750).attr(\"d\", area(data))\n\n        svg.select(\".x.axis\")\n          .transition()\n          .duration(750)\n          .call(xAxis);\n        svg.select(\".y.axis\")\n          .transition()\n          .duration(750)\n          .call(yAxis);\n        circle\n          .data(data)\n          .transition()\n          .duration(750)\n          .attr(\"cx\", d => xScale(d.time))\n          .attr(\"cy\", d => yScale(d[key]))\n      }\n      onMounted(() => {\n        setAreaAndScale(chartType.value);\n        let flag = 0;\n        store.subscribe((mutation) => {\n          if (mutation.type === \"CHANGE_RESPONSE_CHART\") {\n            if (!flag) initDraw(resTimeList.value, chartType.value);\n            else draw(resTimeList.value, chartType.value);\n            flag = 1;\n          }\n        })\n      })\n      return {\n        chartType\n      }\n    }\n  }\n</script>\n\n<style>\n  .chartWrap {\n    border: 1px solid #dee3eb;\n    background: #fff;\n  }\n\n  .Chart,\n  .Chart svg {\n    position: relative;\n  }\n\n  circle {\n    fill: #4fc08d;\n  }\n\n  .area {\n    fill: url(#response-gradient);\n    fill-opacity: 0.3;\n  }\n\n  .tooltip {\n    z-index: 1;\n    position: absolute;\n    display: block;\n    text-align: center;\n    width: 150px;\n    height: 100px;\n    padding: 5px;\n    font-size: 1rem;\n    font-weight: bold;\n    background: rgba(249, 158, 26, 0.7);\n    border: 0px;\n    border-radius: 8px;\n    opacity: 0;\n  }\n\n  .tooltip::after {\n    content: '';\n    position: absolute;\n    left: calc(50% - 10px);\n    top: 100%;\n    width: 0;\n    height: 0;\n    border-left: 10px solid transparent;\n    border-right: 10px solid transparent;\n    border-top: 10px solid rgba(249, 158, 26, 0.7);\n    clear: both;\n  }\n\n  .tooltip h2 {\n    margin: 0;\n    font-size: 2rem;\n  }\n\n  .tooltip p {\n    margin: 0;\n    padding: 0;\n  }\n</style>"]}]}